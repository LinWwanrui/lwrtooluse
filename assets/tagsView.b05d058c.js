import{d as ye,b as ee,u as Ve,f as Ce,o as se,e as p,z as Le,S as d,E as Te,A as ae,_ as Re}from"./index.20f86bbc.js";import{K as be,aC as Se,a as A,az as te,aD as qe,aH as Ae,a1 as De,f as E,J as Ie,G as ke,ai as xe,e as Pe,aJ as $e,b as Ue,aa as _e,n as M,ah as F,m as w,p as C,Y as O,S as Ee,q as ie,F as ne,a7 as Me,M as B,a0 as L,V as T,R as N,X as Fe}from"./vue.48bd3665.js";import{S as Oe}from"./sortable.esm.a99254e8.js";const Be=be({name:"layoutTagsView",components:{Contextmenu:Se(()=>ye(()=>import("./contextmenu.eac58662.js"),["./contextmenu.eac58662.js","./vue.48bd3665.js","./index.20f86bbc.js","./index.52abd502.css","./contextmenu.a56cbf61.css"],import.meta.url))},setup(){const n=A([]),h=A(),D=A(),j=A(),H=ee(),W=Ve(),y=ee(),{themeConfig:R}=te(W),{tagsViewRoutes:I}=te(y),u=Ce(),c=qe(),r=Ae(),t=De({routeActive:"",routePath:c.path,dropdown:{x:"",y:""},sortable:"",tagsRefsIndex:0,tagsViewList:[],tagsViewRoutesList:[]}),re=E(()=>R.value.tagsStyle),o=E(()=>R.value),le=E(()=>s=>se.setTagsViewNameI18n(s)),ue=s=>o.value.isShareTagsView?s.path===t.routePath:s.query&&Object.keys(s.query).length||s.params&&Object.keys(s.params).length?s.url?s.url===t.routeActive:s.path===t.routeActive:s.path===t.routePath,f=s=>{d.set("tagsViewList",s)},z=async()=>{t.routeActive=await g(c),t.routePath=await c.meta.isDynamic?c.meta.isDynamicPath:c.path,t.tagsViewList=[],t.tagsViewRoutesList=I.value,oe()},oe=async()=>{d.get("tagsViewList")&&o.value.isCacheTagsView?t.tagsViewList=await d.get("tagsViewList"):(await t.tagsViewRoutesList.map(s=>{s.meta.isAffix&&!s.meta.isHide&&(s.url=g(s),t.tagsViewList.push({...s}),u.addCachedView(s))}),await k(c.path,c)),Q(o.value.isShareTagsView?t.routePath:t.routeActive)},K=async(s,e)=>{let a=e.meta.isDynamic?e.meta.isDynamicPath:s;if(t.tagsViewList.filter(l=>l.path===a&&ae(e.meta.isDynamic?l.params?l.params:null:l.query?l.query:null,e.meta.isDynamic?e!=null&&e.params?e==null?void 0:e.params:null:e!=null&&e.query?e==null?void 0:e.query:null)).length<=0){let l=t.tagsViewRoutesList.find(m=>m.path===a);if(!l||l.meta.isAffix||l.meta.isLink&&!l.meta.isIframe)return!1;e.meta.isDynamic?l.params=e.params:l.query=e.query,l.url=g(l),t.tagsViewList.push({...l}),await u.addCachedView(l),f(t.tagsViewList)}},J=(s,e)=>{let a=e.meta.isDynamic?e.meta.isDynamicPath:s;t.tagsViewList.forEach(i=>{i.path===a&&!ae(e.meta.isDynamic?i.params?i.params:null:i.query?i.query:null,e.meta.isDynamic?e!=null&&e.params?e==null?void 0:e.params:null:e!=null&&e.query?e==null?void 0:e.query:null)&&(e.meta.isDynamic?i.params=e.params:i.query=e.query,i.url=g(i),f(t.tagsViewList))})},k=(s,e)=>{M(async()=>{let a="";if(e&&e.meta.isDynamic){if(o.value.isShareTagsView?await J(s,e):await K(s,e),t.tagsViewList.some(i=>i.path===e.meta.isDynamicPath))return f(t.tagsViewList),!1;a=t.tagsViewRoutesList.find(i=>i.path===e.meta.isDynamicPath)}else{if(o.value.isShareTagsView?await J(s,e):await K(s,e),t.tagsViewList.some(i=>i.path===s))return f(t.tagsViewList),!1;a=t.tagsViewRoutesList.find(i=>i.path===s)}if(!a||a.meta.isLink&&!a.meta.isIframe)return!1;e&&e.meta.isDynamic?a.params=e!=null&&e.params?e==null?void 0:e.params:c.params:a.query=e!=null&&e.query?e==null?void 0:e.query:c.query,a.url=g(a),await u.addCachedView(a),await t.tagsViewList.push({...a}),await f(t.tagsViewList)})},X=async s=>{const e=decodeURI(s);let a={};if(t.tagsViewList.forEach(i=>{i.transUrl=V(i),i.transUrl?i.transUrl===V(i)&&(a=i):i.path===e&&(a=i)}),!a)return!1;await u.delCachedView(a),p.emit("onTagsViewRefreshRouterView",s),a.meta.isKeepAlive&&u.addCachedView(a)},Y=s=>{t.tagsViewList.map((e,a,i)=>{e.meta.isAffix||(o.value.isShareTagsView?e.path===s:e.url===s)&&(u.delCachedView(e),t.tagsViewList.splice(a,1),setTimeout(()=>{(t.tagsViewList.length===a&&o.value.isShareTagsView?t.routePath===s:t.routeActive===s)?i[i.length-1].meta.isDynamic?a!==i.length?r.push({name:i[a].name,params:i[a].params}):r.push({name:i[i.length-1].name,params:i[i.length-1].params}):a!==i.length?r.push({path:i[a].path,query:i[a].query}):r.push({path:i[i.length-1].path,query:i[i.length-1].query}):(t.tagsViewList.length!==a&&o.value.isShareTagsView?t.routePath===s:t.routeActive===s)&&(i[a].meta.isDynamic?r.push({name:i[a].name,params:i[a].params}):r.push({path:i[a].path,query:i[a].query}))},0))}),f(t.tagsViewList)},ce=s=>{d.get("tagsViewList")&&(t.tagsViewList=[],d.get("tagsViewList").map(e=>{e.meta.isAffix&&!e.meta.isHide&&(e.url=g(e),u.delOthersCachedViews(e),t.tagsViewList.push({...e}))}),k(s,c),f(t.tagsViewList))},me=()=>{d.get("tagsViewList")&&(u.delAllCachedViews(),t.tagsViewList=[],d.get("tagsViewList").map(s=>{s.meta.isAffix&&!s.meta.isHide&&(s.url=g(s),t.tagsViewList.push({...s}),r.push({path:t.tagsViewList[t.tagsViewList.length-1].path}))}),f(t.tagsViewList))},fe=async s=>{const e=t.tagsViewList.find(a=>o.value.isShareTagsView?a.path===s:a.url===s);e.meta.isDynamic?await r.push({name:e.name,params:e.params}):await r.push({name:e.name,query:e.query}),H.setCurrenFullscreen(!0)},G=s=>{let e={};return t.tagsViewList.forEach(a=>{a.transUrl=V(a),a.transUrl?a.meta.isDynamic?a.transUrl===V(a)&&a.transUrl===decodeURI(s.path)&&(e=a):a.transUrl===V(a)&&a.transUrl===s.commonUrl&&(e=a):a.path===decodeURI(s.path)&&(e=a)}),e||null},x=async s=>{if(s.commonUrl=V(s),!G(s))return Te({type:"warning",message:"\u8BF7\u6B63\u786E\u8F93\u5165\u8DEF\u5F84\u53CA\u5B8C\u6574\u53C2\u6570\uFF08query\u3001params\uFF09"});const{path:e,name:a,params:i,query:l,meta:m,url:b}=G(s);switch(s.contextMenuClickId){case 0:m.isDynamic?await r.push({name:a,params:i}):await r.push({path:e,query:l}),X(c.fullPath);break;case 1:Y(o.value.isShareTagsView?e:b);break;case 2:m.isDynamic?await r.push({name:a,params:i}):await r.push({path:e,query:l}),ce(e);break;case 3:me();break;case 4:fe(o.value.isShareTagsView?e:b);break}},ge=(s,e)=>{const{clientX:a,clientY:i}=e;t.dropdown.x=a,t.dropdown.y=i,D.value.openContextmenu(s)},we=(s,e)=>{if(!s.meta.isAffix&&e.which===2){const a=Object.assign({},{contextMenuClickId:1,...s});x(a)}},he=(s,e)=>{t.tagsRefsIndex=e,r.push(s)},V=s=>{let e=s.query&&Object.keys(s.query).length>0?s.query:s.params;if(!e)return"";let a="";for(let[i,l]of Object.entries(e))s.meta.isDynamic?a+=`/${l}`:a+=`&${i}=${l}`;return s.meta.isDynamic?`${s.path.split(":")[0]}${a.replace(/^\//,"")}`:`${s.path}${a.replace(/^&/,"?")}`},g=s=>{let e=s.query&&Object.keys(s.query).length>0?s.query:s.params;if(!e||Object.keys(e).length<=0)return s.path;let a="";for(let i in e)a+=e[i];return`${s.meta.isDynamic?s.meta.isDynamicPath:s.path}-${a}`},pe=s=>{h.value.$refs.wrap$.scrollLeft+=s.wheelDelta/4},de=()=>{M(()=>{if(n.value.length<=0)return!1;let s=n.value[t.tagsRefsIndex],e=t.tagsRefsIndex,a=n.value.length,i=n.value[0],l=n.value[n.value.length-1],m=h.value.$refs.wrap$,b=m.scrollWidth,U=m.offsetWidth,Z=m.scrollLeft,_=n.value[t.tagsRefsIndex-1],v=n.value[t.tagsRefsIndex+1],S="",q="";s===i?m.scrollLeft=0:s===l?m.scrollLeft=b-U:(e===0?S=i.offsetLeft-5:S=(_==null?void 0:_.offsetLeft)-5,e===a?q=l.offsetLeft+l.offsetWidth+5:q=v.offsetLeft+v.offsetWidth+5,q>Z+U?m.scrollLeft=q-U:S<Z&&(m.scrollLeft=S)),h.value.update()})},Q=s=>{M(async()=>{let e=await t.tagsViewList;t.tagsRefsIndex=e.findIndex(a=>o.value.isShareTagsView?a.path===s:a.url===s),de()})},P=async()=>{const s=document.querySelector(".layout-navbars-tagsview-ul");if(!s)return!1;t.sortable.el&&t.sortable.destroy(),t.sortable=Oe.create(s,{animation:300,dataIdAttr:"data-url",disabled:!o.value.isSortableTagsView,onEnd:()=>{const e=[];t.sortable.toArray().map(a=>{t.tagsViewList.map(i=>{i.url===a&&e.push({...i})})}),f(e)}})},$=async()=>{await P(),se.isMobile()&&t.sortable.el&&t.sortable.destroy()};return Ie(()=>{$(),window.addEventListener("resize",$),p.on("onCurrentContextmenuClick",s=>{x(s)}),p.on("openOrCloseSortable",()=>{P()}),p.on("openShareTagsView",()=>{o.value.isShareTagsView&&(r.push("/home"),t.tagsViewList=[],t.tagsViewRoutesList.map(s=>{s.meta.isAffix&&!s.meta.isHide&&(s.url=g(s),t.tagsViewList.push({...s}))}))})}),ke(()=>{p.off("onCurrentContextmenuClick",()=>{}),p.off("openOrCloseSortable",()=>{}),p.off("openShareTagsView",()=>{}),window.removeEventListener("resize",$)}),xe(()=>{n.value=[]}),Pe(()=>{z(),P()}),$e(async s=>{t.routeActive=g(s),t.routePath=s.meta.isDynamic?s.meta.isDynamicPath:s.path,await k(s.path,s),Q(o.value.isShareTagsView?t.routePath:t.routeActive)}),Ue(Le.state,s=>{if(s.tagsViewRoutes.tagsViewRoutes.length===t.tagsViewRoutesList.length)return!1;z()},{deep:!0}),{isActive:ue,onContextmenu:ge,onMousedownMenu:we,onTagsClick:he,tagsRefs:n,contextmenuRef:D,scrollbarRef:h,tagsUlRef:j,onHandleScroll:pe,getThemeConfig:o,setTagsStyle:re,setTagsViewNameI18n:le,refreshCurrentTagsView:X,closeCurrentTagsView:Y,onCurrentContextmenuClick:x,..._e(t)}}});const Ne=["data-url","onContextmenu","onMousedown","onClick"],je={key:0,class:"iconfont icon-webicon318 layout-navbars-tagsview-ul-li-iconfont"};function He(n,h,D,j,H,W){const y=F("SvgIcon"),R=F("el-scrollbar"),I=F("Contextmenu");return w(),C("div",{class:B(["layout-navbars-tagsview",{"layout-navbars-tagsview-shadow":n.getThemeConfig.layout==="classic"}])},[O(R,{ref:"scrollbarRef",onWheel:L(n.onHandleScroll,["prevent"])},{default:Ee(()=>[ie("ul",{class:B(["layout-navbars-tagsview-ul",n.setTagsStyle]),ref:"tagsUlRef"},[(w(!0),C(ne,null,Me(n.tagsViewList,(u,c)=>(w(),C("li",{key:c,class:B(["layout-navbars-tagsview-ul-li",{"is-active":n.isActive(u)}]),"data-url":u.url,onContextmenu:L(r=>n.onContextmenu(u,r),["prevent"]),onMousedown:r=>n.onMousedownMenu(u,r),onClick:r=>n.onTagsClick(u,c),ref_for:!0,ref:r=>{r&&(n.tagsRefs[c]=r)}},[n.isActive(u)?(w(),C("i",je)):T("",!0),!n.isActive(u)&&n.getThemeConfig.isTagsviewIcon?(w(),N(y,{key:1,name:u.meta.icon,class:"pr5"},null,8,["name"])):T("",!0),ie("span",null,Fe(n.setTagsViewNameI18n(u)),1),n.isActive(u)?(w(),C(ne,{key:2},[O(y,{name:"ele-RefreshRight",class:"ml5 layout-navbars-tagsview-ul-li-refresh",onClick:h[0]||(h[0]=L(r=>n.refreshCurrentTagsView(n.$route.fullPath),["stop"]))}),u.meta.isAffix?T("",!0):(w(),N(y,{key:0,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-active",onClick:L(r=>n.closeCurrentTagsView(n.getThemeConfig.isShareTagsView?u.path:u.url),["stop"])},null,8,["onClick"]))],64)):T("",!0),u.meta.isAffix?T("",!0):(w(),N(y,{key:3,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-three",onClick:L(r=>n.closeCurrentTagsView(n.getThemeConfig.isShareTagsView?u.path:u.url),["stop"])},null,8,["onClick"]))],42,Ne))),128))],2)]),_:1},8,["onWheel"]),O(I,{dropdown:n.dropdown,ref:"contextmenuRef",onCurrentContextmenuClick:n.onCurrentContextmenuClick},null,8,["dropdown","onCurrentContextmenuClick"])],2)}const Je=Re(Be,[["render",He],["__scopeId","data-v-6011edb1"]]);export{Je as default};
